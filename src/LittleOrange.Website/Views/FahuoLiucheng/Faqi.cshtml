@{
    ViewBag.Title = "Faqi";
    Layout = "~/Views/Shared/_Layout.cshtml";
    this.ViewBag.TopMenu = "Workflow";
}
<h3 style="text-align:center">发货申请单</h3>
<form class="form-horizontal" id="baseInfoForm">
    <fieldset>
        <legend>基本信息</legend>
        <div class='row-fluid'>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >省份<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='shengfen' />
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >地区<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='diqu' />
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >发货日期<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large date' name='fahuoRiqi' />
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >汇款日期<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large date' name='huikuanRiqi' />
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >汇款金额<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='huikuanJine' />
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >汇款类型<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='huikuanLeixing' />
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >汇款单位<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='huikuanDanwei' />
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="control-group">
                    <label class="control-label" >到款单位<font style="color: Red">*</font></label>
                    <div class="controls">
                        <input type='text' class='input-large' name='daokuanDanwei' />
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span12">
                <div class="control-group">
                    <label class="control-label" >开票单位<font style="color: Red">*</font></label>
                    <div class="controls">
                        <textarea class='input-xxlarge' name='kaipiaoDanwei' rows='3' ></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span12">
                <div class="control-group">
                    <label class="control-label" >收货地址<font style="color: Red">*</font></label>
                    <div class="controls">
                    <textarea class='input-xxlarge' name='shouhuoDizhi' rows='3' ></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class='row-fluid'>
            <div class="span12">
                <div class="control-group">
                    <label class="control-label" >收货人及电话<font style="color: Red">*</font></label>
                    <div class="controls">
                    <textarea class='input-xxlarge' name='shouhuoren' rows='3' ></textarea>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>产品信息</legend>
        <div style="padding-left: 80px;">
            <div id="chanpinGrid"></div>
        </div>
    </fieldset>
    <fieldset>
        <legend>备注信息</legend>
        <div class='row-fluid'>
            <div class="control-group">
                <label class="control-label" >随货附带</label>
                <div class="controls">
                <textarea class='input-xxlarge' name='suihuoFudai' rows='3' ></textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" >备注</label>
                <div class="controls">
                <textarea class='input-xxlarge' name='beizhu' rows='3' ></textarea>
                </div>
            </div>
        </div>
    </fieldset>
    <div class="control-group">
    <div class="controls">
        <button id="btnSubmit" type="submit" class="btn btn-primary" data-loading-text="提交中...">提交</button>
        <button id="btnCancel" type="button" class="btn">取消</button>
    </div>
    </div>
</form>


<script language="javascript" type="text/javascript">
var mobanId = '@this.Request["mobanId"]';
var chanpinGrid = $("#chanpinGrid").datagrid({
		columns:[
			{title: "产品名称", width: 150, field:"name"},
			{title: "规格", width: 80, field:"guige"},
			{title: "生产企业", width: 150, field:"shengchanQiye"},
			{title: "单位", width: 60, field:"danwei"},
			{title: "总数量", width: 60, field:"zongshuliang"},
			{title: "开票单价", width: 80, field:"kaipiaoDanjia"},
			{title: "总金额", width: 80, field:"zongjine"},
			{title: "件数", width: 60, field:"jianshu"}
		],
		canSort: false,
		singleSelect: true,
		showNumberRow: false,
        height: 150,
        selectedRow: function(){
            btnChexiao.prop("disabled", false);
        },
        unselectedRow: function(){
            var rows = renwuGrid.datagrid("getSelectedRows");
            btnChexiao.prop("disabled", rows.length == 0);
        }
	});

$("#baseInfoForm").validate({
    sendForm : false,
    onBlur: true,
    onChange: true,
	eachValidField : function() {
		$(this).closest('.control-group').removeClass('error');
        $(this).next('.help-inline').hide();
	},
	eachInvalidField : function() {
		$(this).closest('.control-group').addClass('error');
        $(this).next('.help-inline').show();
	},
    valid: function(){
        var baseInfoFormValue = $("#baseInfoForm").getFormValue();
        var chanpinList = [{name: "mingcheng1"}];
        $("#btnSubmit").button("loading");
        $.post("@this.Url.Action("Faqi")", {mobanId: mobanId, biaodanJson: $.toJSON(baseInfoFormValue)}, function(data){
            $("#btnSubmit").button("reset");
            if(data.result == 0){
                location = "@this.Html.Raw(this.Url.Action("Yibande", "Workflow"))";
            }
            else{
                alert(data.message);
            }
        });
    }
});
$("#btnCancel").click(function(){
    location = "@this.Html.Raw(this.Url.Action("FaqiLiucheng", "Workflow"))";
});
</script>

